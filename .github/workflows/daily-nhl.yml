name: Daily NHL Data Fetch

on:
  schedule:
    - cron: '0 12 * * *'
  workflow_dispatch:

jobs:
  fetch-nhl:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Fetch and Tailor NHL Data
        run: |
          # Get today's date in YYYY-MM-DD format
          TODAY=$(date +%Y-%m-%d)
          
          # 1. Fetch from Official NHL API (No Key Required)
          # 2. Use JQ to transform the nested gameWeek structure into your specific format
          curl -s "https://api-web.nhle.com/v1/schedule/$TODAY" | jq '{
            games: [
              .gameWeek[].games[] | {
                date: .startTimeUTC | split("T")[0],
                time: .startTimeUTC | split("T")[1] | split("Z")[0],
                home: .homeTeam.commonName.default,
                visitor: .awayTeam.commonName.default
              }
            ]
          }' > nhl_data.json

      - name: Push NHL file back to GitHub
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action Robot"
          git add nhl_data.json
          git commit -m "Automated NHL update: $(date +%Y-%m-%d)" || exit 0
          git push
